---
# ansible-playbook -i HOST, -u `whoami` hadoop.yml
#
# wget http://www-us.apache.org/dist/hadoop/common/hadoop-2.7.3/hadoop-2.7.3.tar.gz
#
# http://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-common/SingleCluster.html
-
  hosts:
    all

  vars:
    command: hadoop
    ver: 2.7.3
    path: /usr

  tasks:

  -
    name: "test {{command}}"
    stat:
      path: "{{path}}/hadoop-{{ver}}/bin/{{command}}"
    ignore_errors: true
    register: stat
  -
    assert:
      that:
        - "not stat.stat.exists"
      msg: "Command {{command}} already exists."

  -
    name: "test hadoop-{{ver}}.tar.gz"
    stat:
      path: "/tmp/hadoop-{{ver}}.tar.gz"
    ignore_errors: true
    register: stat

  -
    name: "wget hadoop-{{ver}}.tar.gz"
    get_url:
      url: "http://www-us.apache.org/dist/hadoop/common/hadoop-{{ver}}/hadoop-{{ver}}.tar.gz"
      dest: "/tmp/hadoop-{{ver}}.tar.gz"
    when: stat.stat.exists == False

  -
    name: unpack
    unarchive:
      src: "/tmp/hadoop-{{ver}}.tar.gz"
      dest: "{{path}}"
      remote_src: True
